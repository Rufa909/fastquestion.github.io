<!DOCTYPE html>
<html lang="vi">
  <head>
    <meta charset="UTF-8" />
    <title>Xem Lại Bài Làm</title>
    <link rel="stylesheet" href="style.css" />
  </head>
  <body>
    <div id="userInfo"></div>
    <table border="1" cellpadding="10" id="reviewTable">
      <thead>
        <tr>
          <th>Câu</th>
          <th>Đáp án đã chọn</th>
          <th>Đáp án đúng</th>
          <th>Kết quả</th>
        </tr>
      </thead>
      <tbody></tbody>
    </table>

    <script>
      const correctAnswers = {
        q1: "C",
        q2: "D",
        q3: "B",
        q4: "A",
        q5: "A",
        q6: "B",
        q7: "C",
        q8: "A",
        q9: "A",
        q10: "D",
        q11: "C",
        q12: "D",
        q13: "D",
        q14: "C",
        q15: "C",
      };

      const params = new URLSearchParams(window.location.search);
      const username = params.get("username");

      if (!username) {
        document.body.innerHTML = "<p>Không có username trong URL.</p>";
      } else {
        fetch("/users")
          .then((res) => res.json())
          .then((users) => {
            const user = users.find((u) => u.username === username);
            if (!user) {
              document.body.innerHTML = "<p>Không tìm thấy người dùng.</p>";
              return;
            }

            document.getElementById("userInfo").innerHTML = `
      <p><strong>Tên:</strong> ${user.username}</p>
      <p><strong>Bắt đầu:</strong> ${new Date(
        user.startedAt
      ).toLocaleString()}</p>
      <p><strong>Nộp bài:</strong> ${new Date(
        user.submittedAt
      ).toLocaleString()}</p>
    `;

            const tbody = document.querySelector("#reviewTable tbody");
            Object.keys(correctAnswers).forEach((q) => {
              const userAnswer = user.answers[q] || "—";
              const correct = correctAnswers[q];
              const isCorrect = userAnswer === correct;

              const row = document.createElement("tr");
              row.innerHTML = `
        <td>${q}</td>
        <td>${userAnswer}</td>
        <td>${correct}</td>
        <td style="color: ${isCorrect ? "green" : "red"}">${
                isCorrect ? "✔" : "✘"
              }</td>
      `;
              tbody.appendChild(row);
            });
          })
          .catch((err) => {
            document.body.innerHTML = `<p>Lỗi khi tải dữ liệu: ${err}</p>`;
          });
      }
    </script>
    <div class="back" style="margin: 20px;">
      <a href="index.html" style="color: black;">Quay Lại</a>
    </div>
  </body>
</html>
